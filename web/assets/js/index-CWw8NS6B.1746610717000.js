import{r as L}from"./request-DVq9aUXx.1746610717000.js";import{r as g,w as M,j as K,m as te,Z as E,W as p,$ as k,c as a,u as C,a3 as B,X as l,V as U,a1 as I,J as D,G as N,a as j,t as oe,F as ae,_ as ne}from"./@vue-fLYPIjUY.1746610717000.js";import{J as le,T as se,t as Z,B as Q,c as re,K as de,N as z,U as ie,r as J,O as ue,k as O,F as ce,v as pe,I as me,P as fe,f as ve,Q as _e,s as W,R as he,V as ge,W as ye,X as xe}from"./ant-design-vue-BpavHdd2.1746610717000.js";import{a3 as X,a4 as ke,G as we,a5 as be,A as Ce,a6 as H,a7 as Ue,P as $e}from"./@ant-design-UKH4ne3D.1746610717000.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.1746610717000.js";import{d as Ve}from"./lodash-es-BdrSUpMS.1746610717000.js";import"./axios-xsH4HHeE.1746610717000.js";import"./qs-DWyNioqb.1746610717000.js";import"./call-bind-apply-helpers-C7Jo5fGj.1746610717000.js";import"./function-bind-CHqF18-c.1746610717000.js";import"./es-errors-CFxpeikN.1746610717000.js";import"./side-channel-TS9q-xWm.1746610717000.js";import"./object-inspect-DfXY_2pI.1746610717000.js";import"./crypto-js-BgjyW-Hw.1746610717000.js";import"./side-channel-list-_TmVZgbW.1746610717000.js";import"./side-channel-map-BZsF5Y1D.1746610717000.js";import"./get-intrinsic-CU05uU9n.1746610717000.js";import"./es-object-atoms-Ditt1eQ6.1746610717000.js";import"./math-intrinsics-Cv-yPkyD.1746610717000.js";import"./gopd-fcd2-aIC.1746610717000.js";import"./es-define-property-bDCdrV83.1746610717000.js";import"./has-symbols-BaUvM3gb.1746610717000.js";import"./get-proto-CILV4W56.1746610717000.js";import"./dunder-proto-C-KZDCBh.1746610717000.js";import"./hasown-Cox-EnJL.1746610717000.js";import"./call-bound-B7A2eXPh.1746610717000.js";import"./side-channel-weakmap-CC2eNExe.1746610717000.js";import"./index-Cp69W5iq.1746610717000.js";import"./vue-i18n-IEV7hEqF.1746610717000.js";import"./@intlify-qjRvhfuG.1746610717000.js";import"./nprogress-s5woMcFz.1746610717000.js";/* empty css                                  */import"./dayjs-BZGIbuBu.1746610717000.js";import"./pinia-k4ewiRes.1746610717000.js";import"./pinia-plugin-persistedstate-n2tMOXAx.1746610717000.js";import"./vue-router-Bc5cQyvF.1746610717000.js";import"./@iconify-CxAgNnh-.1746610717000.js";import"./@babel-Bq4_u9L9.1746610717000.js";import"./@ctrl-DOFZgDuz.1746610717000.js";import"./resize-observer-polyfill-B1PUzC5B.1746610717000.js";import"./dom-align-CRCehRfe.1746610717000.js";import"./async-validator-9PlIezaS.1746610717000.js";import"./scroll-into-view-if-needed-CBdOu1fd.1746610717000.js";import"./compute-scroll-into-view-1gs_hJI2.1746610717000.js";import"./throttle-debounce-CUWDS_la.1746610717000.js";import"./vue-types-CF28atMM.1746610717000.js";import"./@emotion-BtrR-yrm.1746610717000.js";import"./stylis-D5iaQeiq.1746610717000.js";const P={getVodList(e){return L({url:"/vod/list",method:"get",params:e})},getVodItemInfo(e){return L({url:"/vod/get",method:"get",params:{id:e}})},deleteVod(e){return L({url:"/vod/remove",method:"post",data:{id:e}})},uploadVod(e,_){return L({url:"/vod/upload",method:"post",onUploadProgress:s=>{const t=Math.round(s.loaded/s.total*100);_(t)},data:e})},downloadVod(e){return L({url:`/vod/download/${e}`,method:"get",responseType:"blob"})},getVodProgress(e){return L({url:"/vod/progress",method:"get",params:{id:e}})},getVodUploadAccept(){return L({url:"/vod/accept",method:"get"})},vodRetran(e){return L({url:"/vod/retran",method:"post",data:{id:e}})},vodEdit(e){return L({url:"/vod/save",method:"post",data:e})},uploadVodSnap(e,_){return L({url:"/vod/snap",method:"post",headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},onUploadProgress:s=>{const t=Math.round(s.loaded/s.total*100);_(t)},data:e})}};function Re(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":e<1024*1024*1024?(e/(1024*1024)).toFixed(2)+" MB":(e/(1024*1024*1024)).toFixed(2)+" GB"}function Le(e){if(e<60)return`${e} 秒`;if(e<3600){const _=Math.floor(e/60),s=e%60;return s===0?`${_} 分钟`:`${_} 分钟 ${s} 秒`}else{const _=Math.floor(e/3600),s=Math.floor(e%3600/60),t=e%60;let m=`${_} 小时`;return s>0&&(m+=`${s} 分钟`),t>0&&(m+=`${t} 秒`),m}}const Ie={class:"cursor-pointer rounded-md overflow-hidden bg-white h-full min-h-[200px] relative flex flex-col"},De={key:0,class:"flex-1 flex flex-col"},Ee={class:"text-left space-y-2 flex-1 flex flex-col justify-between"},Fe={class:"text-left py-2 px-2 space-y-2"},Se={class:"text-sm text-gray-600 truncate font-semibold"},Be={class:"flex justify-end items-center space-x-2 p-2"},Oe={key:1,class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},je={__name:"card",props:["data"],emits:["onClick","onEdit","onDelect","onRetran","refresh"],setup(e,{emit:_}){const s=e,t=_,m=()=>{t("onClick",s.data)},r=()=>{t("onEdit",s.data)},c=()=>{t("onDelect",s.data.id)},u=()=>{t("onRetran",s.data.id)},w=async()=>{const h=await P.downloadVod(s.data.id),x=new Blob([h.data]),n=window.URL.createObjectURL(x),o=document.createElement("a");o.style.display="none",o.href=n,o.download=s.data.name+".mp4",document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o)},d=g(null),$=g(0),V=()=>{d.value||(d.value=setInterval(async()=>{try{const h=await P.getVodProgress(s.data.id);h.data&&($.value=h.data.reason),(s.data.status==="done"||h.data.reason==100)&&(clearInterval(d.value),d.value=null),t("refresh")}catch(h){console.error("拉取进度失败",h)}},3e3))};return M(()=>s.data,h=>{h.status!=="done"?V():(clearInterval(d.value),d.value=null)},{deep:!0}),K(()=>{s.data.status!=="done"&&V()}),te(()=>{d.value&&(clearInterval(d.value),d.value=null)}),(h,x)=>{const n=le,o=se,f=Z,i=Q,y=re,R=de;return p(),E("div",Ie,[e.data.status==="done"?(p(),E("div",De,[k("div",{class:"relative",onClick:m},[a(n,{class:"aspect-video w-full object-cover",preview:!1,src:e.data.snapUrl+`?=${Date.now()}`,fallback:"/assets/images/noImg.png"},null,8,["src"]),a(C(X),{class:"text-white absolute left-1/2 top-1/2 text-4xl -translate-x-1/2 -translate-y-1/2 hover:text-green transition-all"})]),k("div",Ee,[k("div",Fe,[k("div",Se,B(e.data.name),1),a(f,{wrap:"",size:"small"},{default:l(()=>[e.data.aspect?(p(),U(o,{key:0,bordered:!1},{default:l(()=>[D(B(e.data.aspect),1)]),_:1})):I("",!0),e.data.audioCodec?(p(),U(o,{key:1,bordered:!1},{default:l(()=>[D(B(e.data.audioCodec),1)]),_:1})):I("",!0),e.data.videoCodec?(p(),U(o,{key:2,bordered:!1},{default:l(()=>[D(B(e.data.videoCodec),1)]),_:1})):I("",!0),e.data.size?(p(),U(o,{key:3,bordered:!1},{default:l(()=>[D(B(C(Re)(e.data.size)),1)]),_:1})):I("",!0),e.data.duration?(p(),U(o,{key:4,bordered:!1},{default:l(()=>[D(B(C(Le)(e.data.duration)),1)]),_:1})):I("",!0),e.data.shared?(p(),U(o,{key:5,color:"green",bordered:!1},{default:l(()=>x[0]||(x[0]=[D("分享中")])),_:1})):I("",!0)]),_:1})]),k("div",Be,[a(y,{title:"播放"},{default:l(()=>[a(i,{type:"text",onClick:N(m,["stop"])},{icon:l(()=>[a(C(X))]),_:1})]),_:1}),a(y,{title:"编辑"},{default:l(()=>[a(i,{type:"text",onClick:N(r,["stop"])},{icon:l(()=>[a(C(ke))]),_:1})]),_:1}),a(y,{title:"下载"},{default:l(()=>[a(i,{type:"text",onClick:N(w,["stop"])},{icon:l(()=>[a(C(we))]),_:1})]),_:1}),a(R,{placement:"topRight",title:"您确定要重新转码这条视频吗？","ok-text":"是","cancel-text":"否",onConfirm:u},{default:l(()=>[a(y,{title:"重新转码"},{default:l(()=>[a(i,{type:"text"},{icon:l(()=>[a(C(be))]),_:1})]),_:1})]),_:1}),a(R,{placement:"topRight",title:"您确定要删除这条视频吗？","ok-text":"是","cancel-text":"否",onConfirm:c},{default:l(()=>[a(i,{type:"text",danger:""},{icon:l(()=>[a(C(Ce))]),_:1})]),_:1})])])])):(p(),E("div",Oe,[a(C(z),{percent:$.value,type:"circle",width:64,"stroke-color":"#409eff"},null,8,["percent"])]))])}}},Me={class:"space-y-4"},Te={class:"flex flex-col items-center justify-center py-8"},qe={class:"text-xs text-gray-400 mt-1"},Ae={key:1,class:"px-2"},G=".mp3,.wav,.mp4,.mpg,.mpeg,.wmv,.avi,.rmvb,.mkv,.flv,.mov,.3gpp,.3gp,.webm,.m4v,.mng,.vob",Ne={__name:"upload",props:{open:{type:Boolean,required:!0}},emits:["update:open","refreshList","callback"],setup(e,{emit:_}){const s=e,t=_,m=g(""),r=g([]),c=g(0),u=g(!1),w=j({file:null});M(()=>s.open,n=>{n?V():x()});const d=n=>($(n),!1);async function $(n){var f,i;const o=new FormData;o.append("file",n),u.value=!0,c.value=0,t("callback",!0);try{await P.uploadVod(o,y=>{c.value=y}),ue.success({message:"上传成功",description:"文件已成功上传！"}),t("refreshList"),h()}catch(y){console.log("上传失败：",y),O.error(((i=(f=y.response)==null?void 0:f.data)==null?void 0:i.message)||"上传失败，请重试")}finally{u.value=!1,t("callback",!1)}}async function V(){try{const n=await P.getVodUploadAccept();m.value=n.data||G}catch(n){console.error(n),m.value=G}}const h=()=>{t("update:open",!1)};function x(){r.value=[],w.file=null,c.value=0,u.value=!1}return(n,o)=>{const f=ie,i=z,y=J;return p(),U(y,{open:e.open,title:"上传视频",footer:null,width:"60%",onCancel:h},{default:l(()=>[k("div",Me,[c.value?(p(),E("div",Ae,[a(i,{percent:c.value,status:"active"},null,8,["percent"])])):(p(),U(f,{key:0,name:"file","file-list":r.value,"before-upload":d,accept:m.value,"max-count":1,onChange:n.handleFileChange},{default:l(()=>[k("div",Te,[a(C(H),{class:"text-4xl text-gray-400"}),o[0]||(o[0]=k("p",{class:"mt-2 text-sm text-gray-500"},[D(" 拖放文件到此 或 点击 "),k("span",{class:"text-primary"},"上传")],-1)),k("p",qe," 支持文件类型："+B(m.value||G),1)])]),_:1},8,["file-list","accept","onChange"]))])]),_:1},8,["open"])}}},Ge={class:"player-pro-vod"},Ke={__name:"vod",props:{background:{type:String,default:""},videoUrl:{type:String,default:""},watermark:{type:Object,default:()=>{}},isLogo:{type:Boolean,default:!0},muted:{type:Boolean,default:!1}},emits:["contextmenuClose","statsInfo"],setup(e,{emit:_}){const s=_,t=g(null),m=g(!0),r=g(!1),c=g(null),u=e,w=()=>{var n=c.value;let o={isLive:!1,MSE:!0,stretch:!1,isLogo:u.isLogo};t.value=new window.EasyPlayerPro(n,o),t.value.on("error",(f,i)=>{console.log("error:",f,i),h(),r.value=!0}),t.value.on("timeout",()=>{}),t.value.on("delayTimeout",()=>{}),t.value.on("playbackEnd",()=>{}),t.value.on("liveEnd",()=>{s("contextmenuClose")}),t.value.on("recordEnd",f=>{}),t.value.on("play",()=>{}),t.value.on("contextmenuClose",()=>{s("contextmenuClose")}),t.value.on("stats",f=>{let i=f;i.videoPlaybackQuality=t.value.valueplayer.getVideoPlaybackQuality(),i.videoInfo=t.value.valueplayer.video&&t.value.valueplayer.video.videoInfo||{},i.audioInfo=t.value.valueplayer.audio&&t.value.valueplayer.audio.audioInfo||{},i.kbpsShow=t.value.valueplayer.control?t.value.valueplayer.control.kbpsShow:"0 KB/s",s("statsInfo",i)})},d=()=>{u.videoUrl!=""&&(r.value=!1,t.value&&t.value.play(u.videoUrl).then(()=>{}).catch(n=>{console.error("playerPro error:",n),setTimeout(()=>{$()},2e3)}))},$=()=>{m.value=!1,h().then(()=>{m.value=!0,setTimeout(()=>{V().then(()=>{d()})},100)})},V=()=>new Promise((n,o)=>{w(),n()}),h=()=>new Promise((n,o)=>{x(),setTimeout(()=>{n()},100)}),x=()=>{t.value&&(t.value.destroy(),t.value=null)};return M(()=>u.videoUrl,n=>{n==""?x():$()},{deep:!0}),K(()=>{w(),u.videoUrl!=""&&d()}),oe(()=>{x()}),(n,o)=>(p(),E("div",Ge,[m.value?(p(),E("div",{key:0,ref_key:"EasyplayerProRef",ref:c},null,512)):I("",!0),k("span",null,[r.value?(p(),U(C(Ue),{key:0,onClick:$})):I("",!0)])]))}},Qe=Pe(Ke,[["__scopeId","data-v-be7a26aa"]]),Je={class:"w-full aspect-video"},We={__name:"player",props:{open:{type:Boolean,default:!1},url:{type:String,default:""}},emits:["update:open"],setup(e,{emit:_}){const s=_,t=()=>{s("update:open",!1)};return(m,r)=>{const c=J;return p(),U(c,{width:"60%",title:"播放",open:e.open,footer:null,onCancel:t},{default:l(()=>[k("div",Je,[a(Qe,{videoUrl:e.url},null,8,["videoUrl"])])]),_:1},8,["open"])}}},Xe={key:0,class:"mt-2"},Ze=["src"],ze={__name:"edit",emits:["update:open","refresh"],setup(e,{expose:_,emit:s}){const t=g(!1),m=s,r=j({id:"",name:"",shared:!1,sharedLink:""}),c=g(void 0),u=g(void 0),w=n=>{c.value=n.file;const o=new FileReader;o.onload=f=>{u.value=f.target.result},o.readAsDataURL(c.value)},d=g(!1);async function $(n){if(!d.value){d.value=!0;try{const o=P.vodEdit(n);let f=Promise.resolve();if(c.value){const R=new FormData;R.append("id",n.id),R.append("cover",c.value),f=P.uploadVodSnap(R,()=>{})}const[i,y]=await Promise.all([o,f]);O.success("操作成功"),m("refresh"),x()}catch(o){console.error(o),O.error("操作失败，请重试")}finally{d.value=!1}}}const V=async()=>{const n=new FormData;n.append("id",r.id),n.append("time","00:00:01"),await P.uploadVodSnap(n,()=>{});const{data:o}=await P.getVodItemInfo(r.id);u.value=o.snapUrl+`?t=${Date.now()}`,c.value=void 0,O.success("重置成功"),m("refresh")},h=n=>{r.id=n.id,r.name=n.name,r.shared=n.shared,r.sharedLink=n.sharedLink,u.value=n.snapUrl+`?t=${Date.now()}`,t.value=!0},x=()=>{t.value=!1,r.id="",r.name="",r.shared=!1,r.sharedLink="",c.value=void 0,u.value=void 0};return _({open:h}),(n,o)=>{const f=me,i=pe,y=Q,R=fe,v=Z,b=ve,T=_e,q=ce,A=J;return p(),U(A,{open:t.value,"onUpdate:open":o[3]||(o[3]=F=>t.value=F),title:"编辑视频","confirm-loading":d.value,onCancel:x,"ok-button-props":{htmlType:"submit",form:"editForm"},centered:""},{default:l(()=>[a(q,{id:"editForm",model:r,layout:"vertical",onFinish:$,class:"pt-2"},{default:l(()=>[a(i,{name:"name",label:"视频名称",rules:[{required:!0,message:"请输入视频名称"}]},{default:l(()=>[a(f,{value:r.name,"onUpdate:value":o[0]||(o[0]=F=>r.name=F),placeholder:"请输入视频名称"},null,8,["value"])]),_:1}),a(i,{label:"视频封面"},{default:l(()=>[a(v,null,{default:l(()=>[a(R,{"max-count":1,showUploadList:!1,beforeUpload:()=>!1,customRequest:()=>{},name:"file",accept:".png,.jpg,.jpeg",onChange:w},{default:l(()=>[a(y,null,{default:l(()=>[a(C(H)),o[4]||(o[4]=D(" 上传封面 "))]),_:1})]),_:1}),a(y,{onClick:V},{default:l(()=>o[5]||(o[5]=[D("重置封面")])),_:1})]),_:1}),u.value?(p(),E("div",Xe,[k("img",{src:u.value,alt:"封面预览",class:"max-w-[200px] border border-gray-200 rounded"},null,8,Ze)])):I("",!0)]),_:1}),a(i,{name:"shared",label:"是否共享","value-prop-name":"checked"},{default:l(()=>[a(b,{checked:r.shared,"onUpdate:checked":o[1]||(o[1]=F=>r.shared=F)},null,8,["checked"])]),_:1}),r.sharedLink!=""&&r.shared?(p(),U(i,{key:0,label:"分享链接"},{default:l(()=>[a(f,{value:r.sharedLink,placeholder:"-",class:"mb-4"},null,8,["value"]),a(T,{value:r.sharedLink},null,8,["value"])]),_:1})):I("",!0),a(i,{name:"id",hidden:""},{default:l(()=>[a(f,{value:r.id,"onUpdate:value":o[2]||(o[2]=F=>r.id=F)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])}}},He={class:"bg-white rounded-md cursor-pointer p-2 flex justify-between items-center"},Ye={class:"mt-5"},et={key:1,class:"p-2 bg-white rounded-md"},Zt={__name:"index",setup(e){const _=W.PRESENTED_IMAGE_SIMPLE,s=g(),t=g(!1),m=g(!1),r=g(""),c=g(1),u=j({start:0,limit:12,sort:"",order:"",q:""}),w=j({items:[],total:0});K(()=>{d()});function d(){u.start=(c.value-1)*u.limit,P.getVodList(u).then(v=>{w.items=v.data.rows,w.total=v.data.total}).catch(v=>{console.error(v),O.error("获取列表失败")})}const $=v=>{c.value=v,d()},V=v=>{d()},h=Ve(()=>{c.value=1,d()},500);M(()=>u.q,()=>{h()});const x=()=>{t.value=!0},n=()=>{},o=v=>{r.value=v.videoUrl,m.value=!0},f=()=>{m.value=!1,r.value=""},i=v=>{const b={id:v.id,name:v.name,shared:v.shared,sharedLink:v.sharedLink,snapUrl:v.snapUrl};s.value.open(b)},y=v=>{P.deleteVod(v).then(b=>{b.data.code==200&&d()}).catch(b=>{O.error("删除失败")})},R=v=>{P.vodRetran(v).then(b=>{d()})};return(v,b)=>{const T=Q,q=he,A=xe,F=ge,Y=W,ee=ye;return p(),E("div",null,[k("div",He,[a(T,{type:"primary",onClick:x},{icon:l(()=>[a(C($e))]),default:l(()=>[b[2]||(b[2]=D(" 上传视频 "))]),_:1}),a(q,{class:"w-68",value:u.q,"onUpdate:value":b[0]||(b[0]=S=>u.q=S),placeholder:"请输入视频名称","enter-button":"",onSearch:V},null,8,["value"])]),k("div",Ye,[w.items.length>0?(p(),U(F,{key:0,gutter:[16,16]},{default:l(()=>[(p(!0),E(ae,null,ne(w.items,(S,tt)=>(p(),U(A,{xs:24,sm:24,md:12,lg:8,xl:6,xxl:4,key:S.id},{default:l(()=>[a(je,{data:S,onOnClick:o,onOnDelect:y,onOnRetran:R,onOnEdit:i,onRefresh:d},null,8,["data"])]),_:2},1024))),128))]),_:1})):(p(),E("div",et,[a(Y,{image:C(_)},null,8,["image"])]))]),a(ee,{class:"mt-4 text-right",current:c.value,"page-size":u.limit,total:w.total,"show-less-items":"","show-total":S=>`共 ${S} 项`,onChange:$},null,8,["current","page-size","total","show-total"]),a(We,{open:m.value,url:r.value,"onUpdate:open":f},null,8,["open","url"]),a(ze,{ref_key:"editRef",ref:s,onRefresh:d},null,512),a(Ne,{open:t.value,onRefreshList:d,"onUpdate:open":b[1]||(b[1]=S=>t.value=!1),onCallback:n},null,8,["open"])])}}};export{Zt as default};
