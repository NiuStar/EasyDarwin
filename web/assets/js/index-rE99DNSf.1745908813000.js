import{r as V}from"./request-YcnqGFH7.1745908813000.js";import{r as g,w as E,j as M,m as J,Z as R,W as v,$ as x,c as a,u as C,a3 as I,X as s,V as w,a1 as $,J as L,G as S,a as D,t as W,F as X,_ as Z}from"./@vue-fLYPIjUY.1745908813000.js";import{J as H,T as Y,t as z,B as A,c as ee,K as te,N,U as oe,r as T,O as ae,k as O,F as ne,v as le,I as re,f as se,P as de,Q as ie,R as ce,V as ue}from"./ant-design-vue-Cj-U8itT.1745908813000.js";import{a3 as q,a4 as pe,G as me,a5 as fe,A as ve,a6 as _e,a7 as he,P as ye}from"./@ant-design-hG4s7qJ_.1745908813000.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.1745908813000.js";import{d as ke}from"./lodash-es-BdrSUpMS.1745908813000.js";import"./axios-xsH4HHeE.1745908813000.js";import"./qs-DSE2t9XA.1745908813000.js";import"./call-bind-apply-helpers-BcuExw2V.1745908813000.js";import"./function-bind-CHqF18-c.1745908813000.js";import"./es-errors-CFxpeikN.1745908813000.js";import"./side-channel-BL6VZZ_6.1745908813000.js";import"./object-inspect-BnRfInLN.1745908813000.js";import"./crypto-js-DwhFnUKC.1745908813000.js";import"./side-channel-list-yug-uXxR.1745908813000.js";import"./side-channel-map-Dzb7GGi5.1745908813000.js";import"./get-intrinsic-BzF2e9EC.1745908813000.js";import"./es-object-atoms-Ditt1eQ6.1745908813000.js";import"./math-intrinsics-Cv-yPkyD.1745908813000.js";import"./gopd-fcd2-aIC.1745908813000.js";import"./es-define-property-bDCdrV83.1745908813000.js";import"./has-symbols-BaUvM3gb.1745908813000.js";import"./get-proto-CiMKMH9q.1745908813000.js";import"./dunder-proto-COSeH1zQ.1745908813000.js";import"./hasown-D59mRYJb.1745908813000.js";import"./call-bound-B3J_EjOg.1745908813000.js";import"./side-channel-weakmap-ILlw78Ei.1745908813000.js";import"./index-CAN_IODE.1745908813000.js";import"./vue-i18n-CVnhwQ5N.1745908813000.js";import"./@intlify-qjRvhfuG.1745908813000.js";import"./nprogress-DtBTSmDr.1745908813000.js";/* empty css                                  */import"./dayjs-g0tvK8jc.1745908813000.js";import"./pinia-DhPZCg3F.1745908813000.js";import"./pinia-plugin-persistedstate-n2tMOXAx.1745908813000.js";import"./vue-router-DPJtmemu.1745908813000.js";import"./@iconify-aF5GdBrB.1745908813000.js";import"./@babel-Bq4_u9L9.1745908813000.js";import"./@ctrl-DOFZgDuz.1745908813000.js";import"./resize-observer-polyfill-B1PUzC5B.1745908813000.js";import"./dom-align-CRCehRfe.1745908813000.js";import"./async-validator-9PlIezaS.1745908813000.js";import"./scroll-into-view-if-needed-DEyyyXdZ.1745908813000.js";import"./compute-scroll-into-view-1gs_hJI2.1745908813000.js";import"./throttle-debounce-CUWDS_la.1745908813000.js";import"./vue-types-CF28atMM.1745908813000.js";import"./@emotion-BtrR-yrm.1745908813000.js";import"./stylis-D5iaQeiq.1745908813000.js";const P={getVodList(e){return V({url:"/vod/list",method:"get",params:e})},getVodItemInfo(e){return V({url:"/vod/get",method:"get",params:{id:e}})},deleteVod(e){return V({url:"/vod/remove",method:"post",data:{id:e}})},uploadVod(e,f){return V({url:"/vod/upload",method:"post",onUploadProgress:n=>{const t=Math.round(n.loaded/n.total*100);console.log(">>>progress",t,n),f(t)},data:e})},downloadVod(e){return V({url:`/vod/download/${e}`,method:"get",responseType:"blob"})},getVodProgress(e){return V({url:"/vod/progress",method:"get",params:{id:e}})},getVodUploadAccept(){return V({url:"/vod/accept",method:"get"})},vodRetran(e){return V({url:"/vod/retran",method:"post",data:{id:e}})},vodEdit(e){return V({url:"/vod/save",method:"post",data:e})},uploadVodSnap(e,f){return V({url:"/vod/snap",method:"post",headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},onUploadProgress:n=>{const t=Math.round(n.loaded/n.total*100);f(t)},data:e})}};function xe(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":e<1024*1024*1024?(e/(1024*1024)).toFixed(2)+" MB":(e/(1024*1024*1024)).toFixed(2)+" GB"}function be(e){if(e<60)return`${e} 秒`;if(e<3600){const f=Math.floor(e/60),n=e%60;return n===0?`${f} 分钟`:`${f} 分钟 ${n} 秒`}else{const f=Math.floor(e/3600),n=Math.floor(e%3600/60),t=e%60;let p=`${f} 小时`;return n>0&&(p+=`${n} 分钟`),t>0&&(p+=`${t} 秒`),p}}const we={class:"cursor-pointer rounded-md overflow-hidden bg-white h-full relative flex flex-col"},Ce={key:0,class:"flex-1 flex flex-col"},Ue={class:"text-left space-y-2 flex-1 flex flex-col justify-between"},Ve={class:"text-left py-2 px-2 space-y-2"},$e={class:"text-sm text-gray-600 truncate font-semibold"},Le={class:"flex justify-end items-center space-x-2 p-2"},Re={key:1,class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},Pe={__name:"card",props:["data"],emits:["onClick","onEdit","onDelect","onRetran","refresh"],setup(e,{emit:f}){const n=e,t=f,p=()=>{t("onClick",n.data)},l=()=>{t("onEdit",n.data)},h=()=>{t("onDelect",n.data.id)},m=()=>{t("onRetran",n.data.id)},U=async()=>{const u=await P.downloadVod(n.data.id),k=new Blob([u.data]),r=window.URL.createObjectURL(k),d=document.createElement("a");d.style.display="none",d.href=r,d.download=n.data.name+".mp4",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(r),document.body.removeChild(d)},i=g(null),_=g(0),b=()=>{i.value||(i.value=setInterval(async()=>{try{const u=await P.getVodProgress(n.data.id);u.data&&(_.value=u.data.reason),(n.data.status==="done"||u.data.reason==100)&&(clearInterval(i.value),i.value=null),t("refresh")}catch(u){console.error("拉取进度失败",u)}},3e3))};return E(()=>n.data,u=>{u.status!=="done"?b():(clearInterval(i.value),i.value=null)},{deep:!0}),M(()=>{n.data.status!=="done"&&b()}),J(()=>{i.value&&(clearInterval(i.value),i.value=null)}),(u,k)=>{const r=H,d=Y,y=z,o=A,c=ee,F=te;return v(),R("div",we,[e.data.status==="done"?(v(),R("div",Ce,[x("div",{class:"relative",onClick:p},[a(r,{class:"aspect-video w-full object-cover",preview:!1,src:e.data.snapUrl,fallback:"/assets/images/noImg.png"},null,8,["src"]),a(C(q),{class:"text-white absolute left-1/2 top-1/2 text-4xl -translate-x-1/2 -translate-y-1/2 hover:text-green transition-all"})]),x("div",Ue,[x("div",Ve,[x("div",$e,I(e.data.name),1),a(y,{wrap:"",size:"small"},{default:s(()=>[e.data.aspect?(v(),w(d,{key:0,bordered:!1},{default:s(()=>[L(I(e.data.aspect),1)]),_:1})):$("",!0),e.data.audioCodec?(v(),w(d,{key:1,bordered:!1},{default:s(()=>[L(I(e.data.audioCodec),1)]),_:1})):$("",!0),e.data.videoCodec?(v(),w(d,{key:2,bordered:!1},{default:s(()=>[L(I(e.data.videoCodec),1)]),_:1})):$("",!0),e.data.size?(v(),w(d,{key:3,bordered:!1},{default:s(()=>[L(I(C(xe)(e.data.size)),1)]),_:1})):$("",!0),e.data.duration?(v(),w(d,{key:4,bordered:!1},{default:s(()=>[L(I(C(be)(e.data.duration)),1)]),_:1})):$("",!0),e.data.shared?(v(),w(d,{key:5,color:"green",bordered:!1},{default:s(()=>k[0]||(k[0]=[L("分享中")])),_:1})):$("",!0)]),_:1})]),x("div",Le,[a(c,{title:"播放"},{default:s(()=>[a(o,{type:"text",onClick:S(p,["stop"])},{icon:s(()=>[a(C(q))]),_:1})]),_:1}),a(c,{title:"编辑"},{default:s(()=>[a(o,{type:"text",onClick:S(l,["stop"])},{icon:s(()=>[a(C(pe))]),_:1})]),_:1}),a(c,{title:"下载"},{default:s(()=>[a(o,{type:"text",onClick:S(U,["stop"])},{icon:s(()=>[a(C(me))]),_:1})]),_:1}),a(F,{placement:"topRight",title:"您确定要重新转码这条视频吗？","ok-text":"是","cancel-text":"否",onConfirm:m},{default:s(()=>[a(c,{title:"重新转码"},{default:s(()=>[a(o,{type:"text"},{icon:s(()=>[a(C(fe))]),_:1})]),_:1})]),_:1}),a(F,{placement:"topRight",title:"您确定要删除这条视频吗？","ok-text":"是","cancel-text":"否",onConfirm:h},{default:s(()=>[a(o,{type:"text",danger:""},{icon:s(()=>[a(C(ve))]),_:1})]),_:1})])])])):(v(),R("div",Re,[a(C(N),{percent:_.value,type:"circle",width:64,"stroke-color":"#409eff"},null,8,["percent"])]))])}}},Ie={class:"space-y-4"},Be={class:"flex flex-col items-center justify-center py-8"},Fe={class:"text-xs text-gray-400 mt-1"},De={key:1,class:"px-2"},j=".mp3,.wav,.mp4,.mpg,.mpeg,.wmv,.avi,.rmvb,.mkv,.flv,.mov,.3gpp,.3gp,.webm,.m4v,.mng,.vob",Oe={__name:"upload",props:{open:{type:Boolean,required:!0}},emits:["update:open","refreshList","callback"],setup(e,{emit:f}){const n=e,t=f,p=g(""),l=g([]),h=g(0),m=g(!1),U=D({file:null});E(()=>n.open,r=>{r?b():k()});const i=r=>(_(r),!1);async function _(r){var y,o;const d=new FormData;d.append("file",r),m.value=!0,h.value=0,t("callback",!0);try{await P.uploadVod(d,c=>{h.value=c}),ae.success({message:"上传成功",description:"文件已成功上传！"}),t("refreshList"),u()}catch(c){console.log("上传失败：",c),O.error(((o=(y=c.response)==null?void 0:y.data)==null?void 0:o.message)||"上传失败，请重试")}finally{m.value=!1,t("callback",!1)}}async function b(){try{const r=await P.getVodUploadAccept();p.value=r.data||j}catch(r){console.error(r),p.value=j}}const u=()=>{t("update:open",!1)};function k(){l.value=[],U.file=null,h.value=0,m.value=!1}return(r,d)=>{const y=oe,o=N,c=T;return v(),w(c,{open:e.open,title:"上传视频",footer:null,width:"60%",onCancel:u},{default:s(()=>[x("div",Ie,[h.value?(v(),R("div",De,[a(o,{percent:h.value,status:"active"},null,8,["percent"])])):(v(),w(y,{key:0,name:"file","file-list":l.value,"before-upload":i,accept:p.value,"max-count":1,onChange:r.handleFileChange},{default:s(()=>[x("div",Be,[a(C(_e),{class:"text-4xl text-gray-400"}),d[0]||(d[0]=x("p",{class:"mt-2 text-sm text-gray-500"},[L(" 拖放文件到此 或 点击 "),x("span",{class:"text-primary"},"上传")],-1)),x("p",Fe," 支持文件类型："+I(p.value||j),1)])]),_:1},8,["file-list","accept","onChange"]))])]),_:1},8,["open"])}}},Ee={class:"player-pro-vod"},Se={__name:"vod",props:{background:{type:String,default:""},videoUrl:{type:String,default:""},watermark:{type:Object,default:()=>{}},isLogo:{type:Boolean,default:!0},muted:{type:Boolean,default:!1}},emits:["contextmenuClose","statsInfo"],setup(e,{emit:f}){const n=f,t=g(null),p=g(!0),l=g(!1),h=g(null),m=e,U=()=>{var r=h.value;let d={isLive:!1,MSE:!0,stretch:!1,isLogo:m.isLogo};t.value=new window.EasyPlayerPro(r,d),t.value.on("error",(y,o)=>{console.log("error:",y,o),u(),l.value=!0}),t.value.on("timeout",()=>{}),t.value.on("delayTimeout",()=>{}),t.value.on("playbackEnd",()=>{}),t.value.on("liveEnd",()=>{n("contextmenuClose")}),t.value.on("recordEnd",y=>{}),t.value.on("play",()=>{}),t.value.on("contextmenuClose",()=>{n("contextmenuClose")}),t.value.on("stats",y=>{let o=y;o.videoPlaybackQuality=t.value.valueplayer.getVideoPlaybackQuality(),o.videoInfo=t.value.valueplayer.video&&t.value.valueplayer.video.videoInfo||{},o.audioInfo=t.value.valueplayer.audio&&t.value.valueplayer.audio.audioInfo||{},o.kbpsShow=t.value.valueplayer.control?t.value.valueplayer.control.kbpsShow:"0 KB/s",n("statsInfo",o)})},i=()=>{m.videoUrl!=""&&(l.value=!1,t.value&&t.value.play(m.videoUrl).then(()=>{}).catch(r=>{console.error("playerPro error:",r),setTimeout(()=>{_()},2e3)}))},_=()=>{p.value=!1,u().then(()=>{p.value=!0,setTimeout(()=>{b().then(()=>{i()})},100)})},b=()=>new Promise((r,d)=>{U(),r()}),u=()=>new Promise((r,d)=>{k(),setTimeout(()=>{r()},100)}),k=()=>{t.value&&(t.value.destroy(),t.value=null)};return E(()=>m.videoUrl,r=>{r==""?k():_()},{deep:!0}),M(()=>{U(),m.videoUrl!=""&&i()}),W(()=>{k()}),(r,d)=>(v(),R("div",Ee,[p.value?(v(),R("div",{key:0,ref_key:"EasyplayerProRef",ref:h},null,512)):$("",!0),x("span",null,[l.value?(v(),w(C(he),{key:0,onClick:_})):$("",!0)])]))}},je=ge(Se,[["__scopeId","data-v-be7a26aa"]]),Me={class:"w-full aspect-video"},Te={__name:"player",props:{open:{type:Boolean,default:!1},url:{type:String,default:""}},emits:["update:open"],setup(e,{emit:f}){const n=f,t=()=>{n("update:open",!1)};return(p,l)=>{const h=T;return v(),w(h,{width:"60%",title:"播放",open:e.open,footer:null,onCancel:t},{default:s(()=>[x("div",Me,[a(je,{videoUrl:e.url},null,8,["videoUrl"])])]),_:1},8,["open"])}}},qe={__name:"edit",emits:["update:open","refresh"],setup(e,{expose:f,emit:n}){const t=g(!1),p=n,l=D({id:"",name:"",shared:!1,sharedLink:""});async function h(i){(await P.vodEdit(i).catch(b=>{O.error("操作失败")})).data.code==200&&(O.info("操作成功"),p("refresh"),U())}const m=i=>{l.id=i.id,l.name=i.name,l.shared=i.shared,l.sharedLink=i.sharedLink,t.value=!0},U=()=>{t.value=!1,l.id="",l.name="",l.shared=!1,l.sharedLink=""};return f({open:m}),(i,_)=>{const b=re,u=le,k=se,r=de,d=ne,y=T;return v(),w(y,{open:t.value,"onUpdate:open":_[3]||(_[3]=o=>t.value=o),title:"编辑视频","confirm-loading":i.loading,onCancel:U,"ok-button-props":{htmlType:"submit",form:"editForm"},centered:""},{default:s(()=>[a(d,{id:"editForm",model:l,layout:"vertical",onFinish:h,class:"pt-2"},{default:s(()=>[a(u,{name:"name",label:"视频名称",rules:[{required:!0,message:"请输入视频名称"}]},{default:s(()=>[a(b,{value:l.name,"onUpdate:value":_[0]||(_[0]=o=>l.name=o),placeholder:"请输入视频名称"},null,8,["value"])]),_:1}),a(u,{name:"shared",label:"是否共享","value-prop-name":"checked"},{default:s(()=>[a(k,{checked:l.shared,"onUpdate:checked":_[1]||(_[1]=o=>l.shared=o)},null,8,["checked"])]),_:1}),l.sharedLink!=""&&l.shared?(v(),w(u,{key:0,label:"分享链接"},{default:s(()=>[a(b,{value:l.sharedLink,placeholder:"-",class:"mb-4"},null,8,["value"]),a(r,{value:l.sharedLink},null,8,["value"])]),_:1})):$("",!0),a(u,{name:"id",hidden:""},{default:s(()=>[a(b,{value:l.id,"onUpdate:value":_[2]||(_[2]=o=>l.id=o)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])}}},Ae={class:"bg-white rounded-md cursor-pointer p-2 flex justify-between items-center"},Ne={class:"mt-5"},Mt={__name:"index",setup(e){const f=g(),n=g(!1),t=g(!1),p=g(""),l=D({start:0,limit:10,sort:"",order:"",q:""}),h=D({items:[],total:0});M(()=>{m()});const m=()=>{P.getVodList(l).then(o=>{h.items=o.data.rows,h.total=o.data.total}).catch(o=>{console.log(o)})},U=o=>{m()},i=ke(()=>{m()},500);E(()=>l.q,()=>{i()});const _=()=>{n.value=!0},b=()=>{},u=o=>{p.value=o.videoUrl,t.value=!0},k=()=>{t.value=!1,p.value=""},r=o=>{const c={id:o.id,name:o.name,shared:o.shared,sharedLink:o.sharedLink};f.value.open(c)},d=o=>{P.deleteVod(o).then(c=>{c.data.code==200&&m()}).catch(c=>{O.error("删除失败")})},y=o=>{P.vodRetran(o).then(c=>{m()})};return(o,c)=>{const F=A,G=ie,K=ue,Q=ce;return v(),R("div",null,[x("div",Ae,[a(F,{type:"primary",onClick:_},{icon:s(()=>[a(C(ye))]),default:s(()=>[c[2]||(c[2]=L(" 上传视频 "))]),_:1}),a(G,{class:"w-68",value:l.q,"onUpdate:value":c[0]||(c[0]=B=>l.q=B),placeholder:"请输入视频名称","enter-button":"",onSearch:U},null,8,["value"])]),x("div",Ne,[a(Q,{gutter:[16,16]},{default:s(()=>[(v(!0),R(X,null,Z(h.items,(B,Ge)=>(v(),w(K,{xs:24,sm:24,md:12,lg:8,xl:6,xxl:4,key:B.id},{default:s(()=>[a(Pe,{data:B,onOnClick:u,onOnDelect:d,onOnRetran:y,onOnEdit:r,onRefresh:m},null,8,["data"])]),_:2},1024))),128))]),_:1})]),a(Te,{open:t.value,url:p.value,"onUpdate:open":k},null,8,["open","url"]),a(qe,{ref_key:"editRef",ref:f,onRefresh:m},null,512),a(Oe,{open:n.value,onRefreshList:m,"onUpdate:open":c[1]||(c[1]=B=>n.value=!1),onCallback:b},null,8,["open"])])}}};export{Mt as default};
